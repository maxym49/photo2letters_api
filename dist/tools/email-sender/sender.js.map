{"version":3,"sources":["../../../src/tools/email-sender/sender.js"],"names":["Sender","subject","userEmail","readHtmlFile","initTransport","initMessage","transport","nm","createTransport","host","port","secure","auth","user","pass","message","from","to","html","htmlFile","attachments","Promise","resolve","reject","fs","readFile","path","join","__dirname","err","data","log","error","toString","sendMail","console","info","_transport","_message","_userEmail","_subject","_htmlFile","_attachments"],"mappings":"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","sourcesContent":["import nm from 'nodemailer';\r\nimport fs from 'fs';\r\nimport path from 'path';\r\nimport log from '../console/logger';\r\nimport { decryptEmailData } from '../../security/email-sender/email.security';\r\n\r\nexport default class Sender {\r\n  constructor() {\r\n    this.subject = '';\r\n    this.userEmail = '';\r\n  }\r\n\r\n  async init() {\r\n    await this.readHtmlFile();\r\n    this.initTransport();\r\n    this.initMessage();\r\n  }\r\n\r\n  initTransport() {\r\n    this.transport = nm.createTransport({\r\n      host: decryptEmailData('host'),\r\n      port: decryptEmailData('port'),\r\n      secure: true,\r\n      auth: {\r\n        user: decryptEmailData('user'),\r\n        pass: decryptEmailData('pass')\r\n      }\r\n    });\r\n  }\r\n\r\n  initMessage() {\r\n    this.message = {\r\n      from: decryptEmailData('user'),\r\n      to: this.userEmail,\r\n      subject: this.subject,\r\n      html: this.htmlFile,\r\n      attachments: this.attachments\r\n    };\r\n  }\r\n\r\n  readHtmlFile() {\r\n    return new Promise((resolve, reject) => {\r\n      fs.readFile(\r\n        path.join(__dirname, '../../../static/templates', 'eng_template.html'),\r\n        (err, data) => {\r\n          if (err) {\r\n            log.error(err);\r\n            reject(err);\r\n          } else {\r\n            this.htmlFile = data.toString();\r\n            resolve(data);\r\n          }\r\n        }\r\n      );\r\n    });\r\n  }\r\n\r\n  sendMail() {\r\n    return new Promise((resolve, reject) => {\r\n      this.transport.sendMail(this.message, err => {\r\n        if (err) {\r\n          console.error(err);\r\n          reject(err);\r\n        } else {\r\n          log.info(`Mail has been sent to ${this.userEmail}`);\r\n          resolve();\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  set transport(transport) {\r\n    this._transport = transport;\r\n  }\r\n\r\n  set message(message) {\r\n    this._message = message;\r\n  }\r\n\r\n  set userEmail(userEmail) {\r\n    this._userEmail = userEmail;\r\n  }\r\n\r\n  set subject(subject) {\r\n    this._subject = subject;\r\n  }\r\n\r\n  set htmlFile(htmlFile) {\r\n    this._htmlFile = htmlFile;\r\n  }\r\n\r\n  set attachments(attachments) {\r\n    this._attachments = attachments;\r\n  }\r\n\r\n  get transport() {\r\n    return this._transport;\r\n  }\r\n\r\n  get message() {\r\n    return this._message;\r\n  }\r\n\r\n  get subject() {\r\n    return this._subject;\r\n  }\r\n\r\n  get htmlFile() {\r\n    return this._htmlFile;\r\n  }\r\n\r\n  get userEmail() {\r\n    return this._userEmail;\r\n  }\r\n\r\n  get attachments() {\r\n    return this._attachments;\r\n  }\r\n}\r\n"],"file":"sender.js"}